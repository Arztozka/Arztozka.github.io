<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель | Охотник</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Шапка */
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            flex: 1;
            min-width: 200px;
        }
        
        .back-link {
            color: white;
            text-decoration: none;
            background: #3498db;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 1rem;
            white-space: nowrap;
        }
        
        /* Основные стили админки */
        .admin-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .admin-title {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            font-size: 1.3rem;
        }
        
        /* Поисковая строка */
        .search-container {
            margin-bottom: 15px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        /* Таблица товаров */
        .products-container {
            overflow-x: auto;
            margin-bottom: 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        .products-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .products-table th, 
        .products-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .products-table th {
            background-color: #3498db;
            color: white;
            position: sticky;
            top: 0;
        }
        
        .products-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .products-table textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
        }
        
        /* Кнопки */
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .btn-save {
            background-color: #27ae60;
            color: white;
            margin-right: 5px;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-add {
            background-color: #3498db;
            color: white;
            margin-top: 15px;
            padding: 10px 15px;
            font-size: 1rem;
            width: 100%;
        }
        
        /* Форма добавления */
        .add-form {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .add-form h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Превью изображения */
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
            display: none;
        }
        
        .table-image-preview {
            max-width: 50px;
            max-height: 50px;
            margin-top: 5px;
            display: block;
        }
        
        /* Сообщение, когда ничего не найдено */
        .no-results {
            text-align: center;
            padding: 20px;
            color: #777;
            font-style: italic;
        }
        
        /* Адаптивные стили */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .logo, .back-link {
                width: 100%;
                text-align: center;
            }
            
            .back-link {
                margin-top: 10px;
            }
            
            .products-table th, 
            .products-table td {
                padding: 10px 8px;
            }
            
            .btn {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                font-size: 15px;
            }
            
            .admin-panel {
                padding: 15px;
            }
            
            .products-table input,
            .products-table textarea {
                padding: 6px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Проверка авторизации -->
    <script>
        if (sessionStorage.getItem('admin-authenticated') !== 'true') {
            window.location.href = "index.html";
        }
    </script>

    <!-- Шапка -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Админ-панель | Охотник</div>
                <a href="Главная страница.html" class="back-link">← Вернуться на сайт</a>
            </div>
        </div>
    </header>
    
    <!-- Основной контент -->
    <div class="container">
        <div class="admin-panel">
            <h1 class="admin-title">Управление товарами</h1>
            
            <!-- Поисковая строка -->
            <div class="search-container">
                <input type="text" id="search-input" class="search-input" placeholder="Поиск по названию товара...">
            </div>
            
            <div class="products-container">
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>Товар</th>
                            <th>Описание</th>
                            <th>Цена (₽)</th>
                            <th>Наличие</th>
                            <th>Изображение</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="products-list">
                        <!-- Товары будут загружаться здесь -->
                    </tbody>
                </table>
            </div>
            
            <div id="no-results" class="no-results" style="display: none;">
                Товары не найдены. Попробуйте изменить критерии поиска.
            </div>
            
            <div class="add-form">
                <h2>Добавить новый товар</h2>
                <div class="form-group">
                    <label for="product-name">Название товара:</label>
                    <input type="text" id="product-name" placeholder="Например: Смартфон Model X">
                </div>
                <div class="form-group">
                    <label for="product-description">Описание товара:</label>
                    <textarea id="product-description" placeholder="Подробное описание товара"></textarea>
                </div>
                <div class="form-group">
                    <label for="product-price">Цена:</label>
                    <input type="number" id="product-price" placeholder="Например: 25990">
                </div>
                <div class="form-group">
                    <label for="product-stock">Количество в наличии:</label>
                    <input type="number" id="product-stock" placeholder="Например: 5">
                </div>
                <div class="form-group">
                    <label for="product-image">Изображение товара:</label>
                    <input type="file" id="product-image" accept="image/*">
                    <img id="image-preview" class="image-preview" src="#" alt="Превью изображения">
                </div>
                <button class="btn btn-add" id="add-product">Добавить товар</button>
            </div>
        </div>
    </div>

    <script>
        // Локальное хранилище товаров
        let products = JSON.parse(localStorage.getItem('store-products')) || [
            { id: 1, name: "Смартфон Model X", price: "25990", stock: "5" },
            { id: 2, name: "Ноутбук UltraBook Pro", price: "64990", stock: "2" },
            { id: 3, name: "Наушники SoundMax", price: "7490", stock: "0" }
        ];
        
        // Детали товаров
        let productDetails = JSON.parse(localStorage.getItem('product-details')) || {
            1: {
                description: "Флагманский смартфон с впечатляющим 6.7-дюймовым AMOLED-дисплеем, мощным процессором и тройной камерой.",
                image: "https://via.placeholder.com/600"
            },
            2: {
                description: "Мощный ноутбук для работы и развлечений с производительным процессором и качественным дисплеем.",
                image: "https://via.placeholder.com/600"
            }
        };
        
        // Превью изображения при выборе файла
        document.getElementById('product-image').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('image-preview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Загрузка товаров на страницу с учетом поиска
        function loadProducts(searchTerm = '') {
            const productsList = document.getElementById('products-list');
            productsList.innerHTML = '';
            
            const noResultsElement = document.getElementById('no-results');
            
            // Фильтрация товаров по поисковому запросу
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredProducts.length === 0) {
                noResultsElement.style.display = 'block';
            } else {
                noResultsElement.style.display = 'none';
                
                filteredProducts.forEach(product => {
                    const details = productDetails[product.id] || {};
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><input type="text" value="${product.name}" id="name-${product.id}"></td>
                        <td><textarea id="description-${product.id}">${details.description || ''}</textarea></td>
                        <td><input type="number" value="${product.price}" id="price-${product.id}"></td>
                        <td><input type="number" value="${product.stock}" id="stock-${product.id}"></td>
                        <td>
                            <input type="file" id="image-${product.id}" accept="image/*" class="image-input">
                            ${details.image ? `<img src="${details.image}" class="table-image-preview">` : ''}
                        </td>
                        <td>
                            <button class="btn btn-save" onclick="saveProduct(${product.id})">Сохранить</button>
                            <button class="btn btn-delete" onclick="deleteProduct(${product.id})">Удалить</button>
                        </td>
                    `;
                    productsList.appendChild(row);
                    
                    // Настройка превью для изображений в таблице
                    const imageInput = document.getElementById(`image-${product.id}`);
                    if (imageInput) {
                        imageInput.addEventListener('change', function(e) {
                            const file = e.target.files[0];
                            if (file) {
                                const reader = new FileReader();
                                reader.onload = function(event) {
                                    const img = imageInput.nextElementSibling;
                                    if (img) {
                                        img.src = event.target.result;
                                    } else {
                                        const newImg = document.createElement('img');
                                        newImg.src = event.target.result;
                                        newImg.className = 'table-image-preview';
                                        imageInput.parentNode.appendChild(newImg);
                                    }
                                };
                                reader.readAsDataURL(file);
                            }
                        });
                    }
                });
            }
            
            // Сохраняем в localStorage
            localStorage.setItem('store-products', JSON.stringify(products));
            localStorage.setItem('product-details', JSON.stringify(productDetails));
        }
        
        // Обработчик поиска
        document.getElementById('search-input').addEventListener('input', function(e) {
            loadProducts(e.target.value);
        });
        
        // Сохранение изменений товара
        function saveProduct(id) {
            const productIndex = products.findIndex(p => p.id === id);
            if (productIndex !== -1) {
                const imageInput = document.getElementById(`image-${id}`);
                const imageFile = imageInput?.files[0];
                
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Сохраняем изображение как Data URL
                        if (!productDetails[id]) {
                            productDetails[id] = {};
                        }
                        productDetails[id].image = e.target.result;
                        productDetails[id].description = document.getElementById(`description-${id}`).value;
                        
                        // Сохраняем изменения товара
                        saveProductChanges(id);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    // Если новое изображение не выбрано, просто сохраняем изменения
                    if (!productDetails[id]) {
                        productDetails[id] = {};
                    }
                    productDetails[id].description = document.getElementById(`description-${id}`).value;
                    saveProductChanges(id);
                }
            }
        }
        
        function saveProductChanges(id) {
            const productIndex = products.findIndex(p => p.id === id);
            products[productIndex] = {
                id: id,
                name: document.getElementById(`name-${id}`).value,
                price: document.getElementById(`price-${id}`).value,
                stock: document.getElementById(`stock-${id}`).value
            };
            
            localStorage.setItem('store-products', JSON.stringify(products));
            localStorage.setItem('product-details', JSON.stringify(productDetails));
            alert('Изменения сохранены!');
            
            const searchTerm = document.getElementById('search-input').value;
            loadProducts(searchTerm);
        }
        
        // Удаление товара
        function deleteProduct(id) {
            if (confirm('Вы уверены, что хотите удалить этот товар?')) {
                products = products.filter(p => p.id !== id);
                delete productDetails[id];
                localStorage.setItem('store-products', JSON.stringify(products));
                localStorage.setItem('product-details', JSON.stringify(productDetails));
                
                // Перезагружаем с учетом текущего поиска
                const searchTerm = document.getElementById('search-input').value;
                loadProducts(searchTerm);
            }
        }
        
        // Добавление нового товара
        document.getElementById('add-product').addEventListener('click', function() {
            const name = document.getElementById('product-name').value;
            const description = document.getElementById('product-description').value;
            const price = document.getElementById('product-price').value;
            const stock = document.getElementById('product-stock').value;
            const imageInput = document.getElementById('product-image');
            const imageFile = imageInput.files[0];
            
            if (name && price && stock) {
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                
                // Обработка изображения
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        products.push({
                            id: newId,
                            name: name,
                            price: price,
                            stock: stock
                        });
                        
                        productDetails[newId] = {
                            description: description,
                            image: e.target.result
                        };
                        
                        saveAndReload();
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    // Если изображение не выбрано, используем placeholder
                    products.push({
                        id: newId,
                        name: name,
                        price: price,
                        stock: stock
                    });
                    
                    productDetails[newId] = {
                        description: description,
                        image: "https://via.placeholder.com/600"
                    };
                    
                    saveAndReload();
                }
            } else {
                alert('Пожалуйста, заполните все обязательные поля!');
            }
        });
        
        function saveAndReload() {
            localStorage.setItem('store-products', JSON.stringify(products));
            localStorage.setItem('product-details', JSON.stringify(productDetails));
            
            // Очищаем поля формы
            document.getElementById('product-name').value = '';
            document.getElementById('product-description').value = '';
            document.getElementById('product-price').value = '';
            document.getElementById('product-stock').value = '';
            document.getElementById('product-image').value = '';
            document.getElementById('image-preview').style.display = 'none';
            
            const searchTerm = document.getElementById('search-input').value;
            loadProducts(searchTerm);
        }
        
        // Первая загрузка товаров
        loadProducts();
    </script>
</body>
</html>